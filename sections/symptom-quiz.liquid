{{ 'symptom-quiz.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}

<div class="symptom-quiz-wrapper section-{{ section.id }}-padding">
  <div class="page-width">
    
    {%- comment -%} Quiz Header {%- endcomment -%}
    <div class="symptom-quiz__header">
      {%- if section.settings.heading != blank -%}
        <h1 class="symptom-quiz__title">{{ section.settings.heading }}</h1>
      {%- endif -%}
      
      {%- if section.settings.subheading != blank -%}
        <p class="symptom-quiz__subtitle">{{ section.settings.subheading }}</p>
      {%- endif -%}
      
      {%- if section.settings.show_disclaimer -%}
        <div class="symptom-quiz__disclaimer">
          <p>
            <strong>Medical Disclaimer:</strong> 
            This assessment is for product recommendation purposes only and does not constitute medical advice. 
            It does not replace consultation with a healthcare provider.
          </p>
        </div>
      {%- endif -%}
    </div>

    {%- comment -%} Quiz Form Container {%- endcomment -%}
    <div class="symptom-quiz" data-symptom-quiz>
      
      {%- comment -%} Progress Indicator {%- endcomment -%}
      {% render 'quiz-progress', current: 1, total: 8 %}
      
      {%- comment -%} Quiz Form {%- endcomment -%}
      <form class="symptom-quiz__form" data-quiz-form novalidate>
        
        {%- comment -%} Honeypot field for bot prevention {%- endcomment -%}
        <input 
          type="text" 
          name="quiz_website" 
          class="symptom-quiz__honeypot" 
          tabindex="-1" 
          autocomplete="off"
          aria-hidden="true"
        >
        
        {%- comment -%} Question Container - populated by JavaScript {%- endcomment -%}
        <div class="symptom-quiz__questions" data-question-container>
          {%- comment -%} Questions will be rendered here by JavaScript {%- endcomment -%}
        </div>
        
        {%- comment -%} Navigation Buttons {%- endcomment -%}
        <div class="symptom-quiz__navigation">
          <button 
            type="button" 
            class="symptom-quiz__btn symptom-quiz__btn--secondary" 
            data-quiz-prev
            style="display: none;"
          >
            {{ section.settings.btn_prev_text | default: 'Previous' }}
          </button>
          
          <button 
            type="button" 
            class="symptom-quiz__btn symptom-quiz__btn--primary" 
            data-quiz-next
          >
            {{ section.settings.btn_next_text | default: 'Next' }}
          </button>
          
          <button 
            type="submit" 
            class="symptom-quiz__btn symptom-quiz__btn--primary" 
            data-quiz-submit
            style="display: none;"
          >
            <span data-submit-text>{{ section.settings.btn_submit_text | default: 'Submit Assessment' }}</span>
            <span data-submit-loading style="display: none;">
              <svg class="symptom-quiz__spinner" viewBox="0 0 50 50">
                <circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="5"></circle>
              </svg>
              Processing...
            </span>
          </button>
        </div>
        
        {%- comment -%} Error Message Container {%- endcomment -%}
        <div class="symptom-quiz__error" data-quiz-error role="alert" style="display: none;">
          <p></p>
        </div>
        
      </form>
      
      {%- comment -%} Privacy Notice {%- endcomment -%}
      {%- if section.settings.privacy_policy_url != blank -%}
        <div class="symptom-quiz__privacy">
          <p>
            Your data is protected. Read our 
            <a href="{{ section.settings.privacy_policy_url }}" target="_blank" rel="noopener">Privacy Policy</a>.
          </p>
        </div>
      {%- endif -%}
      
    </div>
    
  </div>
</div>

{%- comment -%} Configuration Data for JavaScript {%- endcomment -%}
<script>
  window.AlleDropsQuizConfig = {
    googleSheetsWebAppUrl: {{ section.settings.google_sheets_web_app_url | json }},
    cloudflareWorkerUrl: {{ section.settings.cloudflare_worker_url | json }},
    shopUrl: {{ shop.url | json }},
    useMetaobjects: {{ section.settings.use_metaobjects | default: false }}
  };
</script>

<script src="{{ 'quiz-config.js' | asset_url }}" defer></script>
<script src="{{ 'google-sheets-integration.js' | asset_url }}" defer></script>
<script src="{{ 'symptom-quiz.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Symptom Quiz",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Quiz Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "AlleDrops Symptom Assessment"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Subheading",
      "default": "Take our comprehensive assessment to find the right regional allergy drops for your symptoms."
    },
    {
      "type": "checkbox",
      "id": "show_disclaimer",
      "label": "Show Medical Disclaimer",
      "default": true
    },
    {
      "type": "header",
      "content": "Button Labels"
    },
    {
      "type": "text",
      "id": "btn_prev_text",
      "label": "Previous Button Text",
      "default": "Previous"
    },
    {
      "type": "text",
      "id": "btn_next_text",
      "label": "Next Button Text",
      "default": "Next"
    },
    {
      "type": "text",
      "id": "btn_submit_text",
      "label": "Submit Button Text",
      "default": "Submit Assessment"
    },
    {
      "type": "header",
      "content": "API Configuration"
    },
    {
      "type": "text",
      "id": "google_sheets_web_app_url",
      "label": "Google Sheets Web App URL",
      "info": "URL from your deployed Google Apps Script web app. See google-apps-script/README.md for setup instructions."
    },
    {
      "type": "text",
      "id": "cloudflare_worker_url",
      "label": "Cloudflare Worker URL",
      "info": "URL to your deployed Cloudflare Worker (optional - for Shopify customer metafields)"
    },
    {
      "type": "checkbox",
      "id": "use_metaobjects",
      "label": "Load Questions from Metaobjects",
      "default": false,
      "info": "If enabled, quiz will load questions from Shopify Metaobjects. Otherwise uses hardcoded questions."
    },
    {
      "type": "header",
      "content": "Privacy"
    },
    {
      "type": "url",
      "id": "privacy_policy_url",
      "label": "Privacy Policy URL"
    },
    {
      "type": "header",
      "content": "Section Padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding Top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 36
    }
  ],
  "presets": [
    {
      "name": "Symptom Quiz"
    }
  ]
}
{% endschema %}

